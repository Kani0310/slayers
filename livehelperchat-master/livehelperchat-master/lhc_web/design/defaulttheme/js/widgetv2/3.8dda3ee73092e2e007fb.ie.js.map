{"version":3,"sources":["webpack://LHCReactAPP/./src/components/OfflineChat.js"],"names":["OfflineChat","connect","store","chatwidget","props","state","dispatch","initOfflineForm","get","handleSubmit","bind","handleContentChange","handleContentChangeCustom","event","fields","this","hasFile","formData","FormData","append","name","getIn","helperFunctions","getTimeZone","window","location","href","substring","protocol","length","customFields","getCustomFieldsSubmit","submitData","JSON","stringify","submitOfflineForm","preventDefault","obj","currentState","id","value","setState","size","map","dep","data","prefillFields","field","prevProps","prevState","snapshot","document","getElementById","headerContent","offsetHeight","sendMessageParent","t","className","role","has","mappedFields","chatUI","isInvalid","hasIn","attrPrefill","defaultValueField","onChangeContent","mappedFieldsCustom","key","dangerouslySetInnerHTML","__html","onSubmit","setDefaultValue","departments","type","disabled","Component","withTranslation"],"mappings":"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","file":"3.8dda3ee73092e2e007fb.ie.js","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from \"react-redux\";\nimport ChatField from './ChatField';\nimport StartChat from './StartChat';\nimport { withTranslation } from 'react-i18next';\nimport { initOfflineForm, submitOfflineForm } from \"../actions/chatActions\"\nimport { helperFunctions } from \"../lib/helperFunctions\";\nimport ChatDepartment from './ChatDepartment';\n\n@connect((store) => {\n    return {\n        chatwidget: store.chatwidget\n    };\n})\n\nclass OfflineChat extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n        \n        // Init offline form with all attributes\n        this.props.dispatch(initOfflineForm({\n            'department':this.props.chatwidget.get('department'),\n            'theme' : this.props.chatwidget.get('theme'),\n            'mode' : this.props.chatwidget.get('mode'),\n            'bot_id' : this.props.chatwidget.get('bot_id'),\n            'online' : 0\n        }));\n\n        this.handleSubmit = this.handleSubmit.bind(this);\n        this.handleContentChange = this.handleContentChange.bind(this);\n        this.handleContentChangeCustom = this.handleContentChangeCustom.bind(this);\n    }\n\n    handleSubmit(event) {\n\n        var fields = this.state;\n        var hasFile = false;\n        const formData = new FormData();\n\n        if (typeof fields['File'] !== 'undefined') {\n            hasFile = true;\n            formData.append(\"File\", fields['File'], fields['File'].name);\n        }\n\n        fields['jsvar'] = this.props.chatwidget.get('jsVars');\n        fields['captcha_' + this.props.chatwidget.getIn(['captcha','hash'])] = this.props.chatwidget.getIn(['captcha','ts']);\n        fields['tscaptcha'] = this.props.chatwidget.getIn(['captcha','ts']);\n        fields['user_timezone'] = helperFunctions.getTimeZone();\n        fields['URLRefer'] = window.location.href.substring(window.location.protocol.length);\n        fields['r'] = this.props.chatwidget.get('ses_ref');\n\n        if (this.props.chatwidget.get('operator') != '') {\n            fields['operator'] = this.props.chatwidget.get('operator');\n        }\n        \n        if (this.props.chatwidget.get('priority') !== null) {\n            fields['priority'] = this.props.chatwidget.get('priority');\n        }\n\n        const customFields = helperFunctions.getCustomFieldsSubmit(this.props.chatwidget.getIn(['customData','fields']));\n        if (customFields !== null) {\n            fields = {...fields, ...customFields};\n        }\n\n        let submitData = {\n            'department': this.props.chatwidget.get('department'),\n            'theme' : this.props.chatwidget.get('theme'),\n            'mode' : this.props.chatwidget.get('mode'),\n            'vid' : this.props.chatwidget.get('vid'),\n            'fields' : fields\n        };\n\n        if (hasFile) {\n            formData.append('document', JSON.stringify(submitData));\n        }\n\n        this.props.dispatch(submitOfflineForm(hasFile ? formData : submitData));\n        event.preventDefault();\n    }\n\n    handleContentChange(obj) {\n        var currentState = this.state;\n        currentState[obj.id] = obj.value;\n        this.setState(currentState);\n\n        if (obj.id == 'DepartamentID') {\n            if (this.props.chatwidget.getIn(['offlineData','department','departments']).size > 0){\n                this.props.chatwidget.getIn(['offlineData','department','departments']).map(dep => {\n                    if (dep.get('value') == obj.value) {\n                        if (dep.get('online') == true) {\n                            this.props.dispatch({'type' : 'dep_default', data : obj.value});\n                            this.props.dispatch({'type' : 'onlineStatus', data : true});\n                        }\n                    }\n                })\n            }\n        }\n    }\n\n    componentDidMount() {\n        helperFunctions.prefillFields(this);\n    }\n\n    handleContentChangeCustom(obj) {\n        this.props.dispatch({'type' : 'CUSTOM_FIELDS_ITEM', data : {id : obj.field.get('index'), value : obj.value}});\n    }\n    \n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (document.getElementById('id-container-fluid')) {\n\n            var headerContent = 0;\n\n            if (document.getElementById('widget-header-content')){\n                headerContent = document.getElementById('widget-header-content').offsetHeight;\n            }\n\n            helperFunctions.sendMessageParent('widgetHeight', [{\n                'height' : document.getElementById('id-container-fluid').offsetHeight + headerContent + 10\n            }]);\n        }\n    }\n    \n    render() {\n\n        const { t } = this.props;\n\n        if (this.props.chatwidget.getIn(['offlineData','fetched']) === true && this.props.chatwidget.getIn(['offlineData','disabled']) === true) {\n            return (\n                <div className=\"alert alert-danger m-2\" role=\"alert\">\n                    {t('start_chat.cant_start_a_chat')}\n                </div>\n            )\n        }\n\n        \n        \n        if (this.props.chatwidget.get('offlineData').has('fields')) {\n            var mappedFields = this.props.chatwidget.getIn(['offlineData','fields']).map(field =><ChatField chatUI={this.props.chatwidget.get('chat_ui')} isInvalid={this.props.chatwidget.hasIn(['validationErrors',field.get('identifier')])} attrPrefill={{'attr_prefill_admin' : this.props.chatwidget.get('attr_prefill_admin'), 'attr_prefill' : this.props.chatwidget.get('attr_prefill')}} defaultValueField={this.state[field.get('name')] || field.get('value')} onChangeContent={this.handleContentChange} field={field} />);\n        } else {\n            var mappedFields = \"\";\n        }\n\n        if (this.props.chatwidget.getIn(['customData','fields']).size > 0) {\n            var mappedFieldsCustom = this.props.chatwidget.getIn(['customData','fields']).map(field =><ChatField chatUI={this.props.chatwidget.get('chat_ui')} key={field.get('identifier')} isInvalid={this.props.chatwidget.hasIn(['validationErrors',field.get('identifier')])} defaultValueField={field.get('value')} onChangeContent={this.handleContentChangeCustom} field={field} />);\n        } else {\n            var mappedFieldsCustom = \"\";\n        }\n\n        if (this.props.chatwidget.get('processStatus') == 0 || this.props.chatwidget.get('processStatus') == 1) {\n            return (\n                  <div id=\"id-container-fluid\">\n                    {this.props.chatwidget.get('leave_message') && this.props.chatwidget.hasIn(['chat_ui','operator_profile']) && <div className=\"py-2 px-3 offline-intro-operator\" dangerouslySetInnerHTML={{__html:this.props.chatwidget.getIn(['chat_ui','operator_profile'])}}></div>}\n\n                    {this.props.chatwidget.get('leave_message') && this.props.chatwidget.hasIn(['chat_ui','offline_intro']) && <p className=\"pb-1 mb-0 pt-2 px-3 font-weight-bold offline-intro\" dangerouslySetInnerHTML={{__html:this.props.chatwidget.getIn(['chat_ui','offline_intro'])}}></p>}\n\n                    {!this.props.chatwidget.get('leave_message') && <p className=\"pb-1 mb-0 pt-2 px-3 font-weight-bold offline-intro\">{this.props.chatwidget.getIn(['chat_ui','chat_unavailable'])}</p>}\n\n                    {this.props.chatwidget.get('leave_message') &&\n                    <div className=\"container-fluid\" >\n                        <form onSubmit={this.handleSubmit} className=\"offline-form\">\n                            <div className=\"row pt-2\">\n                                {mappedFields}\n                                {mappedFieldsCustom}\n                                {this.props.chatwidget.hasIn(['offlineData','department']) && <ChatDepartment defaultValueField={this.state['DepartamentID']} setDefaultValue={this.props.chatwidget.get('departmentDefault')} onChangeContent={this.handleContentChange} isInvalid={this.props.chatwidget.hasIn(['validationErrors','department'])} departments={this.props.chatwidget.getIn(['offlineData','department'])} />}\n                            </div>\n                            <div className=\"row\">\n                                <div className=\"col-12 pb-2\">\n                                    <button type=\"submit\" disabled={this.props.chatwidget.get('processStatus') == 1} className=\"btn btn-secondary btn-sm\">{this.props.chatwidget.get('processStatus') == 1 && <i className=\"material-icons\">&#xf113;</i>}{this.props.chatwidget.getIn(['chat_ui','custom_start_button']) || t('start_chat.leave_a_message')}</button>\n                                </div>\n                            </div>\n                        </form>\n                    </div>}\n                      \n                      \n                  </div>\n            )\n        } else if (this.props.chatwidget.get('processStatus') == 2) {\n            return (\n                <div id=\"id-container-fluid\">\n\n                {this.props.chatwidget.hasIn(['chat_ui','operator_profile']) && <div className=\"py-2 px-3 offline-intro-operator\" dangerouslySetInnerHTML={{__html:this.props.chatwidget.getIn(['chat_ui','operator_profile'])}}></div>}\n\n                {this.props.chatwidget.hasIn(['chat_ui','offline_intro']) && <p className=\"pb-1 mb-0 pt-2 px-3 font-weight-bold offline-intro\" dangerouslySetInnerHTML={{__html:this.props.chatwidget.getIn(['chat_ui','offline_intro'])}}></p>}\n\n                    <div className=\"container-fluid\">\n                        <div className=\"row\">\n                            <div className=\"col-12\">\n                                <p className=\"pt-2\">{this.props.chatwidget.getIn(['chat_ui','thank_feedback']) || t('start_chat.thank_you_for_feedback')}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n            )\n        }\n    }\n}\n\nexport default withTranslation()(OfflineChat);\n"],"sourceRoot":""}